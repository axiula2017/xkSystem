选课系统设计文档
=============
## **ID格式**  
#### userID
- 9位数字 (char(9))
- 第一位：0表示老师 1,2,3,4表示大一、大二、大三、大四
- 中间四位院系ID  
- 后四位流水号

#### 课程ID
- 6位
- 起始100000
- 流水号，无实际意义

## **登录界面** 

- 输入账号（学号、教职工号），密码（md5加密）  
- 支持登录，注册，忘记密码


## **学生界面**  
- (模仿学校选课系统)上方为课程表
- 下方为可选课程列表(每页显示10条，可翻页)
- 选课允许模糊匹配  
- 左侧为学生基本信息（年级，姓名，学号，所在学院）


## **老师界面**
- 左侧为老师基本信息
- 列出已经开设的课程
- 支持添加课程，取消课程，查看已选课程的学生

### 添加课程界面  
- 课程名
- 限制人数
- 课程教室 (输入完成后检索出可用的开课时间)
- 开课时间
- 课程学分
- 课程ID服务器端生成
- 选课成功后出现提示窗口

## **数据库设计**


- 院系（**院系代码**，院系名称）  
- 用户（**ID**，姓名，年级，*所属院系代码*，登录密码）  
- 教室（**教室编号**，周一，周二，周三，周四，周五，周六，周日）  
*教室的星期属性为char（11），默认为11个0，如果第1,2节在该教室有课，则把第一位，第二位的0置为1*    
- 课程（**课程号**，课程名，已选人数，限制人数，*教室ID*，*教师ID*，开课时间，学分）  
*开课时间属性为char（3），如果是123，表示周一第二节开始，三个课时* 
- 选课关系（***学生ID，课程ID***）  

## **选课限制**  

- 第一轮选课，学生只能选本院系课程  
- 第二轮选课，学生可选其他院系课程

## **服务请求规则**  
#### 登录
请求
```json
{
    "pid":1,
    "user":"200010001",
    "pwd":"asdffgghhj"
}
```

返回  
```json
{
    "state":true
}
```

#### 注册
请求
```json
{
    "pid":2,
    "name":"Tom",
    "did":"0001",
    "grade":2,
    "pwd":"asdfghj"
}
```

返回
```json
{
    "user":"200010001"
}
```

#### 忘记密码
请求
```json
{
    "pid":3,
    "user":"200010001",
    "name":"Tom",
    "pwd":"newpwd"
}
```
返回
```json
{
    "state":true
}
```

#### 请求学院
请求
```json
{
    "pid":4
}
```
返回
```json
[
    "0001.计算机",
    "0002.数学"
]
```

#### 请求学生课程表信息
请求  
```json
{
    "pid":5,
    "user":100010001
}
```
返回
```json
[
   {
        "cid":"000101",
        "cname":"程序设计",
        "rid":"2108",
        "ctime":"112",
        "tname":"李华"
   },
   {
        "cid":"000101",
        "cname":"数据库",
        "rid":"2108",
        "ctime":"112",
        "tname":"李华"    
   }
]
```
####  查看可选课程  
请求  
支持模糊匹配   
未选课程过多，每页显示10个课程，index表示页数,每页10个数据
```json
{
    "pid":6,
    "index":0,
    "user":"100010001",
    "cname":"",
    "cid":"",
    "tname":""
}
```
返回  
total表示所有待选可课程（方便计算页数）
```json
{
    "total":98,
    "courses":
    [
        {
            "cid":"000101",
            "cname":"程序设计",
            "current":15,
            "max":45,
            "rid":"2108",
            "ctime":"112",
            "tname":"李华",
            "credit":2
        },
        {
            "cid":"000102",
            "cname":"数据库",
            "current":15,
            "max":45,
            "rid":"2108",
            "ctime":"112",
            "tname":"李华",
            "credit":2     
        }
    ]
}
```
#### 学生选课操作
请求  
```json
{
    "pid":7,
    "user":"100010001",
    "cid":"000302"
}
```
返回  
```json
{
    "state":true
}
```

#### 学生退课操作
```json
{
    "pid":8,
    "user":"100010001",
    "cid":"000302"
}
```
返回  
```json
{
    "state":true
}
```
操作
```sql
delete from sc where sid="100010001" and cid="000302"
```

#### 老师添加课程 
请求
```json
{
    "pid":9,
    "user":000010001,
    "cname":"程序设计",
    "rid":"2109",
    "ctime":"312",
    "max":45,
    "credit":2
}
```
返回
```json
{
    "state":true,
    "cid":"000101"
}
{
    "state":false
}
```

#### 老师删除课程
请求  
```json
{
    "pid":10,
    "cid":"000101",
    "user":"000010001"
}
```
返回  
```json
{
    "state":true
}
{
    "state":false
}
```

#### 老师查看自己开设的课程  
请求
```json
{
    "pid":11,
    "user":"0000010001"
}
```
返回
```json
[
        {
            "cid":"000101",
            "cname":"程序设计",
            "current":15,
            "max":45,
            "rid":"2108",
            "ctime":"112",
            "credit":2
        },
        {
            "cid":"000102",
            "cname":"数据库",
            "current":15,
            "max":45,
            "rid":"2108",
            "ctime":"112",
            "credit":2     
        }
]
```
#### 老师查看选择自己课程的学生  
请求
```json
{
     "pid":12,
     "cid":"000101"   
}
```
返回
```json
[
    {
        "id":"100010001",
        "name":"李华",
        "grade":1,
        "dname":"计算机学院"
    },
    {
        "id":"100010002",
        "name":"李华",
        "grade":1,
        "dname":"计算机学院"
    }
]
```

#### 请求用户信息
请求
```json
{
    "pid":13,
    "user":100010001
}
```
返回
```json
{
    "dname":"计算机学院",
    "name":"李华",
    "round":1
}
```

#### 请求所有教室占用情况
请求  
```json
{
    "pid":14,
    "rid":"2108"
}
```
返回  
七个字符串，代表从周一到周日的教师占用情况  
第一个无意义,第n位代表第n-1节课的使用情况
```json
[
    "01100000000",
    "01100000000",
    "00000000000",
    "00110000000",
    "00000000000",
    "00000000000",
    "00000000000",
]
```
#### 请求教室列表
请求
```json
{
    "pid":15
}
```
返回
```json
[
    "2018","2014","2001"
]
```
## **客户端网络接口**   
每次调用send函数后必须调用recv函数

```c++
bool send(const QJsonObject &);//发送
QJsonDocument recv();//接受
```
